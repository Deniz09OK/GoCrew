<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenue sur GoCrew</title>
</head>
<body>
    <!-- Message de bienvenue aprÃ¨s connexion -->
    <h1>Bienvenue sur GoCrew ðŸŽ‰</h1>
    <p>Connexion rÃ©ussie.</p>
    <!-- Lien pour se dÃ©connecter (retour Ã  la page de connexion) -->
    <a href="/">Se dÃ©connecter</a>

    <script>
        // Fonction pour dÃ©coder le payload d'un JWT
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return null;
            }
        }

        // VÃ©rifie le token Ã  chaque chargement de page
        (function() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location = '/';
                return;
            }
            const payload = parseJwt(token);
            if (!payload || !payload.exp) {
                localStorage.removeItem('token');
                window.location = '/';
                return;
            }
            // VÃ©rifie l'expiration (exp est en secondes)
            const now = Math.floor(Date.now() / 1000);
            if (payload.exp < now) {
                localStorage.removeItem('token');
                window.location = '/';
            }
        })();
    </script>
</body>
</html>