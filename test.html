<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Test API Crews</title>
</head>

<body>
    <h1>Test API Crews</h1>

    <!-- Formulaire pour créer un crew -->
    <h2>Créer un Crew</h2>
    <form id="createCrewForm">
        <label>Nom : <input type="text" name="name" required></label><br>
        <label>Description : <input type="text" name="description"></label><br>
        <label>Destination : <input type="text" name="destination"></label><br>
        <label>Budget : <input type="number" name="budget" step="0.01"></label><br>
        <label>Date début : <input type="date" name="start_date"></label><br>
        <label>Date fin : <input type="date" name="end_date"></label><br>
        <label>Owner ID : <input type="number" name="owner_id" required></label><br>
        <button type="submit">Créer Crew</button>
    </form>

    <hr>
    <h2>Résultat API</h2>
    <pre id="result"></pre>

    <script>
        const apiBase = "http://localhost:3000"; // Change 5137 en 3000

        async function sendForm(formId, endpoint) {
            const form = document.getElementById(formId);
            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const body = Object.fromEntries(formData.entries());

                // Convertir number fields en nombre
                for (const key in body) {
                    if (!isNaN(body[key]) && body[key] !== "") {
                        body[key] = Number(body[key]);
                    }
                }

                try {
                    const res = await fetch(apiBase + endpoint, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(body),
                    });
                    const data = await res.json();
                    document.getElementById("result").textContent = JSON.stringify(data, null, 2);
                } catch (err) {
                    document.getElementById("result").textContent = "Erreur: " + err.message;
                }
            });
        }

        // Active le formulaire pour créer un crew
        sendForm("createCrewForm", "/api/crews");
    </script>
</body>

</html>